extends ../layout
block head
  include ../datatables_css
block navbar
block content
  .container
    .page-header
      h1 Puppet Catalog Failure List (Last #{hoursAgo} hours)
    .container
      table(id="table_failures").table.table-condensed
        thead
          tr
            th Hostname
            th Type
            th Timestamp
            th Message
        tbody

block footer
  include ../datatables_js
  script(src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js")
  script(type='text/javascript').
    $(document).ready(function() {
      $('#table_failures').dataTable( {
        "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
        "sPaginationType": "bootstrap",
        "sAjaxSource": '/api/v1/puppet/failures/hours/#{hoursAgo}',
        "iDisplayLength": 20,
        "bStateSave": true,
        "bDeferRender": true,
        "bSortClasses": false,
        "aoColumns": [
          {
            "mData": "certname",
            "sWidth": "220px"
          }, {
            "mData": "resource-type",
            "sWidth": "50px"
          }, {
            "mData": "timestamp",
            "mRender": function(timestamp) {
              return moment(timestamp).format('MMM DD H:mm:ss');
            },
            "sWidth": "60px"
          }, {
            "mData": "message"
          }],
        "aaSorting": [[2,'asc']],
        "oLanguage": {
          "sLengthMenu": "_MENU_ records per page"
        }
      });
    });